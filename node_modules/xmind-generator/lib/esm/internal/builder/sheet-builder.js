import { Sheet } from "../model/sheet.js";
import { asBuilder } from "./types.js";
export function makeSheetBuilder(title) {
  let rootTopicBuilder;
  const relationshipBuilders = [];
  return {
    rootTopic(topicBuilder) {
      rootTopicBuilder = topicBuilder;
      return this;
    },
    relationships(relationships) {
      relationshipBuilders.push(...relationships);
      return this;
    },
    title(sheetTitle) {
      title = sheetTitle;
      return this;
    },
    build() {
      const { topic: rootTopic, reference } = asBuilder(rootTopicBuilder)?.build() ?? {};
      const sheet = new Sheet(title, rootTopic);
      relationshipBuilders.forEach((builder) => {
        const { title: title2, from, to } = asBuilder(builder).build();
        sheet.addRelationship(title2, reference.fetch(from).id, reference.fetch(to).id);
      });
      return sheet;
    }
  };
}
